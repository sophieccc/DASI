<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
<head>
    <title>Consultations</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
    <body>
        <div class="showConsultations panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        </div>
        <p><a class="home" href="index.html">Retour à la page d'Accueil</a></p>
        <script>
            $(document).ready(function() { 
                $('#showConsultations').html("Affichage en cours"); // Message pour le paragraphe de notification
                // Appel AJAX
                $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'showConsultations'
                        },
                        dataType: 'json'
                    })
                    .done(function(response) { // Fonction appelée en cas d'appel AJAX réussi
                        console.log('Response', response); // LOG dans Console Javascript
                        $("a.home").attr("href", response.homepage);
                        if (response.consultations) {  
                            if(response.consultations.length===0){
                                $('.showConsultations').append("<p> No Consultations </p>");
                            }
                            else {
                              response.consultations.forEach(function(item,index) {
                                $('.showConsultations').append(
                                    '<div class="panel panel-default">'+
                                      '<div class="panel-heading" role="tab" id="heading_'+index+'">'+
                                        '<h4 class="panel-title">'+
                                          '<a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse_'+index+'" aria-expanded="true" aria-controls="collapse_'+index+'">'+
                                              item.date+
                                          '</a>'+
                                        '</h4>'+
                                      '</div>'+
                                      '<div id="collapse_'+index+'" class="collapse panel-collapse" role="tabpanel" aria-labelledby="heading_'+index+'">'+
                                        '<div class="panel-body">'+
                                          item.date+
                                        '</div>'+
                                      '</div>'+
                                    '</div>'
                                  );
                              });                                
                            }
                            
                            
                        } else {
                            $('#showConsultations').html("Erreur d'affichage"); // Message pour le paragraphe de notification
                        }
                    })
                    .fail(function(error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                        console.log('Error', error); // LOG dans Console Javascript
                        alert("Erreur lors de l'appel AJAX");
                    })
                    .always(function() { // Fonction toujours appelée

                    });
            });
    </script>
    </body>
</html>
